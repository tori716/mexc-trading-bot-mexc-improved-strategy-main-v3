# MEXC REST API取引ボット - 全体仕様書

**Version:** 1.0.0  
**Last Updated:** 2025-05-30  
**Author:** Trading Bot Team  
**License:** MIT  

---

## 📋 目次

1. [プロジェクト概要](#1-プロジェクト概要)
2. [システム構成](#2-システム構成)
3. [戦略仕様](#3-戦略仕様)
4. [エントリー条件](#4-エントリー条件)
5. [エグジット条件](#5-エグジット条件)
6. [リスク管理](#6-リスク管理)
7. [REST API実装](#7-rest-api実装)
8. [テクニカル指標](#8-テクニカル指標)
9. [データ管理](#9-データ管理)
10. [監視・ログ](#10-監視ログ)
11. [パフォーマンス追跡](#11-パフォーマンス追跡)
12. [デプロイ設定](#12-デプロイ設定)
13. [テスト戦略](#13-テスト戦略)
14. [メンテナンス](#14-メンテナンス)

---

## 1. プロジェクト概要

### 1.1 プロジェクト名
**MEXC REST API高勝率アルトコイン取引ボット**

### 1.2 目的
WebSocket制限に対応したREST APIベースの自動取引システム。監視銘柄25個以内に最適化し、月利65%以上を目標とする高勝率アルトコイン短期取引戦略を実装。

### 1.3 目標パフォーマンス

| メトリクス | 目標値 |
|-----------|--------|
| 勝率 | ≥ 65% |
| 月間リターン | ≥ 65% |
| 最大ドローダウン | ≤ 15% |
| リスク・リワード比 | ≥ 1:2.2 |
| 取引頻度 | 2-3 取引/日 |
| シャープレシオ | ≥ 2.5 |

### 1.4 制約条件

- **API種類**: REST APIのみ（WebSocket制限対応）
- **監視銘柄**: 最大25銘柄
- **初期資金**: $1,000
- **更新頻度**: 5分間隔
- **地域制限**: 日本からの利用を考慮

---

## 2. システム構成

### 2.1 全体アーキテクチャ

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Data Layer    │    │  Strategy Layer │    │  Execution Layer│
├─────────────────┤    ├─────────────────┤    ├─────────────────┤
│ ・市場データ取得 │    │ ・シグナル生成   │    │ ・注文実行       │
│ ・価格履歴管理   │    │ ・リスク管理     │    │ ・ポジション管理 │
│ ・テクニカル分析 │    │ ・銘柄選定       │    │ ・決済実行       │
└─────────────────┘    └─────────────────┘    └─────────────────┘
           │                        │                        │
           └────────────┬───────────────────┬────────────────────┘
                        │                   │
              ┌─────────────────┐    ┌─────────────────┐
              │  Logging Layer  │    │ Monitoring Layer│
              ├─────────────────┤    ├─────────────────┤
              │ ・取引ログ       │    │ ・パフォーマンス │
              │ ・エラーログ     │    │ ・リアルタイム監視│
              │ ・パフォーマンス │    │ ・アラート機能   │
              └─────────────────┘    └─────────────────┘
```

### 2.2 主要クラス構成

#### 2.2.1 MEXCTradingBot（メインクラス）
**責任範囲:**
- API認証・通信管理
- 取引ロジック制御
- ポジション・リスク管理

**主要メソッド:**
- `run_trading_cycle()` - 取引サイクル実行
- `execute_trade()` - 取引実行
- `monitor_positions()` - ポジション監視
- `calculate_position_size()` - ポジションサイズ計算

#### 2.2.2 TechnicalIndicators（テクニカル分析）
**責任範囲:**
- 各種テクニカル指標計算
- カスタム指標実装

**主要メソッド:**
- `rsi(prices, period)` - RSI計算
- `bollinger_bands(prices, period, std_dev)` - ボリンジャーバンド
- `macd(prices, fast, slow, signal)` - MACD計算
- `ema(prices, period)` - 指数移動平均

#### 2.2.3 DataManager（データ管理）
**責任範囲:**
- 価格履歴管理
- K線データ処理
- 出来高データ保存

#### 2.2.4 RiskManager（リスク管理）
**責任範囲:**
- ポジションサイズ計算
- 損切り・利確管理
- 資金管理ルール

#### 2.2.5 OrderManager（注文管理）
**責任範囲:**
- 注文実行・管理
- 約定確認
- 注文履歴管理

---

## 3. 戦略仕様

### 3.1 銘柄選定戦略

#### 3.1.1 Tier分類システム

**Tier 1（最優先銘柄・10銘柄）**
```
AVAXUSDT, LINKUSDT, NEARUSDT, FTMUSDT, ATOMUSDT,
DOTUSDT, MATICUSDT, UNIUSDT, AAVEUSDT, DOGEUSDT
```
- **監視**: 常時監視
- **更新頻度**: 30秒間隔

**Tier 2（準優先銘柄・10銘柄）**
```
ADAUSDT, ALGOUSDT, APEUSDT, ARBUSDT, EGLDUSDT,
FILUSDT, GRTUSDT, ICPUSDT, LTCUSDT, SANDUSDT
```
- **監視**: 市場環境別
- **更新頻度**: 60秒間隔

**Tier 3（補完銘柄・5銘柄）**
```
SHIBUSDT, VETUSDT, MANAUSDT, GALAUSDT, ONEUSDT
```
- **監視**: 条件付き
- **更新頻度**: 60秒間隔

#### 3.1.2 市場環境別選択ロジック

| 市場環境 | 選択銘柄 | 合計 | 基準 |
|---------|---------|------|------|
| **上昇相場** | Tier1(10) + Tier2前半(5) + Tier3前半(3) | 18銘柄 | BTC上昇トレンド、センチメント良好 |
| **横ばい相場** | Tier1(10) + Tier2全部(10) | 20銘柄 | BTC横ばい、ボラティリティ中程度 |
| **下落相場** | Tier1(10) + Tier2後半(5) + Tier3後半(2) | 17銘柄 | BTC下降トレンド、センチメント悪化 |

#### 3.1.3 銘柄別最適化パラメータ

| 銘柄 | RSI(Long/Short) | BB標準偏差 | 価格変動係数 | 出来高係数 |
|------|----------------|-----------|------------|----------|
| **AVAXUSDT** | 58/38 | 2.2 | 1.5 | 2.0 |
| **LINKUSDT** | 58/38 | 2.0 | 1.5 | 2.0 |
| **NEARUSDT** | 60/35 | 2.0 | 1.5 | 2.0 |
| **FTMUSDT** | 60/35 | 2.0 | 1.4 | 2.0 |
| **ATOMUSDT** | 62/35 | 2.0 | 1.5 | 1.8 |
| **DOTUSDT** | 60/35 | 2.0 | 1.5 | 2.0 |
| **MATICUSDT** | 60/35 | 2.0 | 1.5 | 2.0 |
| **UNIUSDT** | 62/35 | 2.0 | 1.5 | 2.0 |
| **AAVEUSDT** | 60/35 | 2.0 | 1.5 | 2.0 |
| **DOGEUSDT** | 58/38 | 2.2 | 1.5 | 2.2 |

**デフォルトパラメータ:**
```yaml
rsi_long: 60
rsi_short: 35
bollinger_std: 2.0
macd_fast: 12
macd_slow: 26
macd_signal: 9
price_change_factor: 1.5
volume_factor: 2.0
```

---

## 4. エントリー条件

### 4.1 ロングポジション条件

#### 4.1.1 必須条件（全て満たす必要あり）

**✅ ボラティリティブレイクアウト**
- 現在価格 > ボリンジャーバンド上限
- 30分価格変動率 ≥ 24h平均変動率 × 1.5

**✅ モメンタム確認**
- 5分足RSI ≥ 設定値 AND RSI < 80
- 15分足MACD > MACDシグナル
- 1時間足 EMA20 > EMA50

**✅ 出来高確認**
- 直近出来高 ≥ 24h平均出来高 × 2.0
- OR 3本連続出来高増加

**✅ 市場環境確認**
- BTC日次変動率 > -5%
- 恐怖・強欲指数 ≠ 極端な恐怖

### 4.2 ショートポジション条件

#### 4.2.1 必須条件（全て満たす必要あり）

**✅ ボラティリティブレイクアウト**
- 現在価格 < ボリンジャーバンド下限
- 30分価格変動率 ≥ 24h平均変動率 × 1.3

**✅ モメンタム確認**
- 5分足RSI ≤ 設定値 AND RSI > 20
- 15分足MACD < MACDシグナル
- 1時間足 EMA20 < EMA50

**✅ 出来高確認**
- 直近出来高 ≥ 24h平均出来高 × 2.0
- OR 3本連続出来高増加

**✅ 市場環境確認**
- BTC日次変動率 < +5%
- 恐怖・強欲指数 ≠ 極端な強欲

### 4.3 時間帯最適化

#### 4.3.1 最適取引時間帯（JST）
- **15:00-18:00** (アジア・ヨーロッパオーバーラップ)
- **22:00-24:00** (米国市場オープン)

#### 4.3.2 非最適時間帯の条件調整
```python
if not is_optimal_time():
    params["rsi_long"] += 5      # より厳しい条件
    params["rsi_short"] -= 5     # より厳しい条件  
    params["volume_factor"] = 3.0      # 出来高条件強化
    params["price_change_factor"] = 1.8 # 変動率条件強化
```

#### 4.3.3 避けるべき時間帯
- **03:00-07:00** (極低流動性時間帯)

---

## 5. エグジット条件

### 5.1 利益確定戦略

#### 5.1.1 段階的利益確定

**第1段階 (ポジションの50%)**
- **利益目標**: 2.4%
- **説明**: 取引コスト考慮の最小利益確定

**第2段階 (残り50%)**
- **固定目標**: 5.0%利益
- **RSI逆転**: Long時RSI>70、Short時RSI<30

#### 5.1.2 トレーリングストップ
- **発動条件**: 利益 > 2.4%
- **コールバック率**: 1.5%
- **説明**: 最高値/最安値から1.5%逆行で決済

### 5.2 損切り戦略

#### 5.2.1 固定損切り
- **損切り率**: 1.5%
- **説明**: エントリー価格から1.5%逆行で全決済
- **リスク・リワード**: 1:2.2以上維持

#### 5.2.2 時間ベース損切り
- **時間制限**: 30分
- **条件**: 利益1.2%未満で決済
- **目的**: 短期取引特性を活かしたリスク回避

#### 5.2.3 テクニカル損切り
- MACD逆転時
- ボリンジャーバンドミドルライン逆抜け時

#### 5.2.4 緊急損切り
- **条件**: BTC 15分間で3%以上変動
- **アクション**: 全ポジション即時決済

---

## 6. リスク管理

### 6.1 ポジションサイジング

#### 6.1.1 基本計算式
```python
position_size = (capital × risk_percentage) / abs(entry_price - stop_loss)
```

#### 6.1.2 基本設定

| パラメータ | 値 | 説明 |
|-----------|----|----- |
| 最大リスク/取引 | 5% | 1取引あたりの最大リスク |
| 最小注文金額 | $10 | 最小注文金額 |
| 最大同時ポジション | 2 | 同時保有ポジション数 |
| 最大日次取引 | 3 | 1日の最大取引回数 |

#### 6.1.3 連続損失調整

| 連続損失回数 | リスク率 | 説明 |
|-------------|---------|------|
| 0回 | 5.0% | 通常リスク |
| 1回 | 2.5% | リスク半減 |
| 2回以上 | 0.0% | 取引停止 |

### 6.2 資金管理

#### 6.2.1 基本設定
- **初期資金**: $1,000
- **最大ポートフォリオリスク**: 15%
- **準備金比率**: 10%

#### 6.2.2 ドローダウン制限

| レベル | 閾値 | アクション |
|--------|------|----------|
| 警告レベル | 10% | 監視強化 |
| 重要レベル | 15% | 取引停止検討 |
| 緊急レベル | 15%超過 | 全ポジション決済・取引停止 |

### 6.3 分散投資ルール

- **同一Tier最大ポジション**: 1
- **推奨Tier組み合わせ**: Tier1 + Tier2/3
- **セクター分散**: 有効
- **相関制限**: 0.7以下

---

## 7. REST API実装

### 7.1 主要エンドポイント

#### 7.1.1 市場データ

| エンドポイント | メソッド | 説明 | レート制限 |
|-------------|---------|------|----------|
| `/api/v3/ticker/24hr` | GET | 24時間価格統計 | 40 req/10s |
| `/api/v3/klines` | GET | K線データ | 20 req/10s |
| `/api/v3/exchangeInfo` | GET | 取引所情報 | 20 req/10s |

#### 7.1.2 取引関連

| エンドポイント | メソッド | 説明 | レート制限 | 認証 |
|-------------|---------|------|----------|-----|
| `/api/v3/order` | POST | 新規注文 | 100 req/10s | 必須 |
| `/api/v3/order` | DELETE | 注文キャンセル | 100 req/10s | 必須 |
| `/api/v3/order` | GET | 注文状況確認 | 20 req/10s | 必須 |
| `/api/v3/account` | GET | アカウント情報 | 20 req/10s | 必須 |

### 7.2 ポーリング戦略

#### 7.2.1 更新頻度

| データ種類 | 頻度 | 対象 |
|-----------|------|------|
| 市場データ更新 | 5分 | 全銘柄 |
| 優先銘柄監視 | 30秒 | Tier 1 |
| 標準銘柄監視 | 60秒 | Tier 2/3 |
| ポジション監視 | 30秒 | オープンポジション |
| 注文状況確認 | 10秒 | 注文後60秒間 |

### 7.3 エラーハンドリング

#### 7.3.1 接続エラー
- **リトライ回数**: 3回
- **リトライ間隔**: 指数バックオフ (1s, 2s, 4s)
- **フォールバック**: エラーログ出力・継続

#### 7.3.2 レート制限エラー
- **アクション**: 待機・リトライ
- **待機時間**: レート制限リセット時間 + 1秒

#### 7.3.3 APIエラー
- **4XX エラー**: ログ出力・スキップ
- **5XX エラー**: 指数バックオフでリトライ
- **タイムアウト**: 即座にリトライ

### 7.4 データキャッシュ

#### 7.4.1 価格履歴
- **ストレージ**: インメモリリスト
- **最大サイズ**: 銘柄あたり100キャンドル
- **更新戦略**: スライディングウィンドウ

#### 7.4.2 市場データ
- **キャッシュ期間**: 60秒
- **無効化**: 新データ到着時

#### 7.4.3 銘柄情報
- **キャッシュ期間**: 24時間
- **ストレージ**: ローカルファイル

---

## 8. テクニカル指標

### 8.1 RSI (Relative Strength Index)

**計算式:**
```
RSI = 100 - (100 / (1 + RS))
RS = 平均上昇幅 / 平均下降幅
```

**パラメータ:**
- **期間**: 14
- **買われ過ぎ**: 70
- **売られ過ぎ**: 30
- **実装**: 標準指数平滑化

### 8.2 ボリンジャーバンド

**計算:**
- **期間**: 20
- **標準偏差**: 2.0
- **中央線**: 単純移動平均
- **上限**: 中央線 + (標準偏差 × 倍率)
- **下限**: 中央線 - (標準偏差 × 倍率)

### 8.3 MACD

**パラメータ:**
- **高速EMA**: 12
- **低速EMA**: 26
- **シグナル線**: 9

**計算:**
- **MACDライン**: EMA(12) - EMA(26)
- **シグナルライン**: EMA(9) of MACDライン
- **ヒストグラム**: MACDライン - シグナルライン

### 8.4 EMA (指数移動平均)

**計算式:**
```
EMA = (価格 × α) + (前回EMA × (1 - α))
α = 2 / (期間 + 1)
```

**使用期間:**
- 20期間
- 50期間

---

## 9. データ管理

### 9.1 データ構造

#### 9.1.1 価格履歴
```python
price_history: List[float]  # 終値データ
max_length: 100            # 最大保持数
```

#### 9.1.2 出来高履歴
```python
volume_history: List[float]  # 出来高データ
max_length: 100             # 最大保持数
```

#### 9.1.3 K線データ
```python
{
    'timestamp': int,    # タイムスタンプ
    'open': float,       # 始値
    'high': float,       # 高値
    'low': float,        # 安値
    'close': float,      # 終値
    'volume': float      # 出来高
}
```

#### 9.1.4 取引履歴
```python
{
    'symbol': str,           # 銘柄
    'direction': str,        # 方向 (long/short)
    'entry_price': float,    # エントリー価格
    'exit_price': float,     # エグジット価格
    'quantity': float,       # 数量
    'pnl_percentage': float, # 損益率
    'pnl_amount': float,     # 損益金額
    'reason': str,           # 決済理由
    'timestamp': float       # タイムスタンプ
}
```

### 9.2 更新メカニズム

#### 9.2.1 価格データ
- **頻度**: 5分毎
- **方法**: スライディングウィンドウ更新
- **保持期間**: 最新100データポイント

#### 9.2.2 市場環境
- **分析頻度**: 毎サイクル
- **基準**: BTCトレンド分析
- **更新トリガー**: 大幅な変化時

---

## 10. 監視・ログ

### 10.1 ログレベル

#### 10.1.1 INFO
- 取引実行
- ポジション開始・決済
- パフォーマンス更新

#### 10.1.2 WARNING
- API制限接近
- 異常な市場変動
- リスク制限接近

#### 10.1.3 ERROR
- API接続失敗
- 注文実行失敗
- 予期しないエラー

### 10.2 ログファイル

| ファイル名 | 内容 |
|-----------|------|
| `trading_bot.log` | メインログ |
| `error.log` | エラーログ |
| `trades.log` | 取引ログ |
| `performance.log` | パフォーマンスログ |

### 10.3 リアルタイム監視

#### 10.3.1 監視メトリクス
- アクティブポジション数
- 日次取引回数
- 現在のドローダウン
- 連続損失回数
- API応答時間

#### 10.3.2 アラートレベル

**高優先度:**
- 最大ドローダウン到達
- 連続損失3回
- API接続失敗

**中優先度:**
- 異常な市場変動
- リスク制限接近

**低優先度:**
- 日次目標達成
- 新規ポジション開始

---

## 11. パフォーマンス追跡

### 11.1 主要メトリクス

#### 11.1.1 収益性指標
```python
total_return = ((current_capital - initial_capital) / initial_capital) × 100
monthly_return = "月次リターン"
daily_return = "日次リターン"
```

#### 11.1.2 リスク指標
```python
win_rate = (winning_trades / total_trades) × 100
profit_factor = total_profit / total_loss
max_drawdown = "最大資産減少率"
sharpe_ratio = (return - risk_free_rate) / volatility
```

#### 11.1.3 取引指標
```python
average_win = "勝ちトレードの平均利益率"
average_loss = "負けトレードの平均損失率"
risk_reward_ratio = average_win / average_loss
trade_frequency = "1日あたりの取引回数"
```

### 11.2 レポート

#### 11.2.1 リアルタイム
- 現在のP&L
- オープンポジション
- 日次統計

#### 11.2.2 日次
- 日次パフォーマンス要約
- 取引履歴
- リスクメトリクス

#### 11.2.3 週次
- 週次パフォーマンス分析
- 戦略効果測定
- パラメータ最適化提案

---

## 12. デプロイ設定

### 12.1 環境設定

#### 12.1.1 開発環境
- **APIキー**: demo/testnet
- **資金**: $100
- **ログレベル**: DEBUG
- **取引実行**: 無効

#### 12.1.2 ステージング環境
- **APIキー**: demo/testnet
- **資金**: $1,000
- **ログレベル**: INFO
- **取引実行**: 無効

#### 12.1.3 本番環境
- **APIキー**: live
- **資金**: $1,000
- **ログレベル**: INFO
- **取引実行**: 有効

### 12.2 依存関係

#### 12.2.1 Python要件
- **Python**: >=3.8

#### 12.2.2 必須パッケージ
```
aiohttp>=3.8.0
pandas>=1.3.0
numpy>=1.21.0
asyncio
logging
json
time
hmac
hashlib
```

### 12.3 セキュリティ

#### 12.3.1 認証
- **APIキー保存**: 環境変数
- **署名方式**: HMAC-SHA256
- **リクエスト署名**: 認証エンドポイントで必須

### 12.4 バックアップ・復旧

#### 12.4.1 バックアップ
- **頻度**: 日次
- **対象**: 取引履歴、パフォーマンスメトリクス、設定

#### 12.4.2 復旧手順
1. 設定復元
2. 取引履歴読み込み
3. ポジション再計算
4. 監視再開

---

## 13. テスト戦略

### 13.1 単体テスト

#### 13.1.1 テクニカル指標
- RSI計算精度
- ボリンジャーバンド計算
- MACD計算
- EMA計算

#### 13.1.2 リスク管理
- ポジションサイズ計算
- 損切り計算
- リスク調整ロジック

#### 13.1.3 取引ロジック
- エントリー条件評価
- エグジット条件評価
- 市場環境分析

### 13.2 統合テスト

#### 13.2.1 API通信
- REST API接続性
- 認証
- データ取得
- 注文実行（デモ）

#### 13.2.2 エンドツーエンド
- 完全な取引サイクル
- エラーハンドリング
- パフォーマンス追跡

### 13.3 バックテスト

#### 13.3.1 履歴データ
- **期間**: 過去6ヶ月
- **銘柄**: 全Tier 1銘柄
- **時間枠**: 5分足データ

#### 13.3.2 検証メトリクス
- 勝率 >= 65%
- 月間リターン >= 65%
- 最大ドローダウン <= 15%
- シャープレシオ >= 2.5

---

## 14. メンテナンス

### 14.1 定期メンテナンス

#### 14.1.1 日次
- ログファイル確認
- パフォーマンス確認
- API接続状況確認

#### 14.1.2 週次
- パラメータ最適化評価
- 銘柄ローテーション見直し
- リスク設定調整

#### 14.1.3 月次
- 戦略有効性評価
- 市場環境変化対応
- システム全体見直し

### 14.2 更新手順

#### 14.2.1 パラメータ更新
1. A/Bテスト実施
2. 段階的ロールアウト
3. パフォーマンス監視

#### 14.2.2 コード更新
1. テスト環境での検証
2. 段階的デプロイ
3. ロールバック準備

### 14.3 監視アラート

#### 14.3.1 パフォーマンス低下
- **トリガー**: 勝率 < 60% (1週間)
- **アクション**: パラメータ見直し・一時停止

#### 14.3.2 API問題
- **トリガー**: API失敗率 > 10%
- **アクション**: 接続設定見直し・代替手段検討

#### 14.3.3 市場変化
- **トリガー**: 戦略効果低下
- **アクション**: 戦略調整・新戦略検討

---

## 📞 サポート・連絡先

**技術的な問題**: GitHub Issues  
**一般的な質問**: Email サポート  
**緊急事態**: アラートシステム経由  

---

**© 2025 Trading Bot Team. All rights reserved.**